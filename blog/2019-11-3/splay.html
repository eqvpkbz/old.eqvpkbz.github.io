<!DOCTYPE html> <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1.0"> <title>初探splay - Eqvpkbz's site</title> <link rel="shortcut icon" href="/favicon.png" type="image/png"> <link rel=stylesheet  href="/styles/material-icons.css"> <link rel=stylesheet  href="/styles/material.min.css" > <link rel=stylesheet  href="/styles/gitment.css"> <link rel=stylesheet  href="/math-renderer/katex/katex.min.css"> <link rel=stylesheet  href="/styles/site.css"> <script src="/scripts/jquery.min.js"></script> <script src="/scripts/js-cookie.js"></script> <script src="/scripts/quicklink.umd.js"></script> <script defer src="/scripts/material.min.js"></script> <script src="/scripts/site.js"></script> <script src="/scripts/gitment.js"></script> <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header"> <header class=mdl-layout__header > <div class=mdl-layout__header-row > <span class=mdl-layout-title >初探splay</span> <div class=mdl-layout-spacer ></div> <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right"> <label class="mdl-button mdl-js-button mdl-button--icon" for=fixed-header-drawer-exp ><i class=material-icons >search</i></label> <div class=mdl-textfield__expandable-holder > <form action="/search.html"><input type=text  class=mdl-textfield__input  placeholder="Search Here" name=q  id=fixed-header-drawer-exp  autocomplete=off  required></form> </div> </div> </div> </header> <div class=mdl-layout__drawer > <span class="mdl-layout-title drawer-title"> <a href="/index.html" style="color: inherit; font-weight: inherit;text-decoration: none;"><img src="/favicon.png" width=32 height=32> Eqvpkbz's Site</a> </span> <nav class=mdl-navigation > <a class=mdl-navigation__link  href="/index.html"><i class="material-icons drawer-icon">home</i> 首页</a> <a class=mdl-navigation__link  href="/posts.html"><i class="material-icons drawer-icon">library_books</i> 所有文章</a> <a class=mdl-navigation__link  href="/about.html"><i class="material-icons drawer-icon">info</i> 关于</a> <a class=mdl-navigation__link  href="/links.html"><i class="material-icons drawer-icon">link</i> 友链</a> <a class=mdl-navigation__link  href="/search.html"><i class="material-icons drawer-icon">search</i> 搜索</a> <a class=mdl-navigation__link  href="https://github.com/eqvpkbz/eqvpkbz.github.io"><i class="material-icons drawer-icon">class</i> GitHub 项目</a> </nav> </div> <main class=mdl-layout__content > <div class=mdl-grid > <div class="mdl-cell main-cell"> <div class="article main-article" lang=en-US > <h1 id=splay >初探splay</h1> <table class=codehilitetable ><tr><td class=linenos ><div class=linenodiv ><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196</pre></div><td class=code ><div class=codehilite ><pre><span></span><span class=cp >#include</span><span class=cpf >&lt;cctype&gt;</span><span class=cp ></span>
<span class=cp >#include</span><span class=cpf >&lt;cstdio&gt;</span><span class=cp ></span>
<span class=k >using</span> <span class=k >namespace</span> <span class=n >std</span><span class=p >;</span>

<span class=cp >#define debug(...) fprintf(stderr,__VA_ARGS__)</span>
<span class=cp >#define DEBUG printf(&quot;Passing [%s] in LINE %lld\n&quot;,__FUNCTION__,__LINE__)</span>
<span class=cp >#define Debug debug(&quot;Passing [%s] in LINE %lld\n&quot;,__FUNCTION__,__LINE__)</span>
<span class=cp >#define file(FILE_NAME) freopen(FILE_NAME&quot;.in&quot;,&quot;r&quot;,stdin),freopen(FILE_NAME&quot;.out&quot;,&quot;w&quot;,stdout)</span>
<span class=cp >#define file_close fclose(stdin),fclose(stdout)</span>

<span class=cp >#define MAXBUF 2097152</span>
<span class=cp >#define FLUSHSIZE 1966080</span>
<span class=cp >#define Finline __inline__ __attribute__ ((always_inline))</span>
<span class=kt >char</span> <span class=n >BUF</span><span class=p >[</span><span class=n >MAXBUF</span><span class=p >],</span><span class=o >*</span><span class=n >P1</span><span class=o >=</span><span class=n >BUF</span><span class=p >,</span><span class=o >*</span><span class=n >P2</span><span class=o >=</span><span class=n >BUF</span><span class=p >;</span>
<span class=n >Finline</span> <span class=kt >int</span> <span class=nf >getc</span><span class=p >(){</span><span class=k >return</span> <span class=n >P1</span><span class=o >==</span><span class=n >P2</span><span class=o >&amp;&amp;</span><span class=p >(</span><span class=n >P2</span><span class=o >=</span><span class=p >(</span><span class=n >P1</span><span class=o >=</span><span class=n >BUF</span><span class=p >)</span><span class=o >+</span><span class=n >fread</span><span class=p >(</span><span class=n >BUF</span><span class=p >,</span><span class=mi >1</span><span class=p >,</span><span class=n >MAXBUF</span><span class=p >,</span><span class=n >stdin</span><span class=p >),</span><span class=n >P1</span><span class=o >==</span><span class=n >P2</span><span class=p >)</span><span class=o >?</span><span class=nl >EOF</span><span class=p >:</span><span class=o >*</span><span class=n >P1</span><span class=o >++</span><span class=p >;}</span>
<span class=kr >inline</span> <span class=kt >int</span> <span class=nf >read</span><span class=p >()</span>
<span class=p >{</span>
    <span class=kt >int</span> <span class=n >ret</span> <span class=o >=</span> <span class=mi >0</span><span class=p >,</span><span class=n >f</span> <span class=o >=</span> <span class=mi >0</span><span class=p >;</span><span class=kt >char</span> <span class=n >ch</span> <span class=o >=</span> <span class=n >getc</span><span class=p >();</span>
    <span class=k >while</span><span class=p >(</span><span class=o >!</span><span class=n >isdigit</span> <span class=p >(</span><span class=n >ch</span><span class=p >)){</span><span class=k >if</span><span class=p >(</span><span class=n >ch</span> <span class=o >==</span> <span class=sc >&#39;-&#39;</span><span class=p >)</span> <span class=n >f</span> <span class=o >=</span> <span class=mi >1</span><span class=p >;</span><span class=n >ch</span> <span class=o >=</span> <span class=n >getc</span><span class=p >();}</span>
    <span class=k >while</span><span class=p >(</span><span class=n >isdigit</span> <span class=p >(</span><span class=n >ch</span><span class=p >)){</span><span class=n >ret</span> <span class=o >=</span> <span class=n >ret</span> <span class=o >*</span> <span class=mi >10</span> <span class=o >+</span> <span class=n >ch</span> <span class=o >-</span> <span class=mi >48</span><span class=p >;</span><span class=n >ch</span> <span class=o >=</span> <span class=n >getc</span><span class=p >();}</span>
    <span class=k >return</span> <span class=n >f</span><span class=o >?-</span><span class=nl >ret</span><span class=p >:</span><span class=n >ret</span><span class=p >;</span>
<span class=p >}</span>
<span class=kt >char</span> <span class=n >buf</span><span class=p >[</span><span class=n >MAXBUF</span><span class=p >],</span><span class=n >print_buf</span><span class=p >[</span><span class=mi >20</span><span class=p >];</span><span class=kt >int</span> <span class=n >p</span><span class=p >,</span><span class=n >p2</span><span class=o >=-</span><span class=mi >1</span><span class=p >;</span>
<span class=kr >inline</span> <span class=kt >void</span> <span class=nf >flush</span><span class=p >(){</span><span class=n >fwrite</span><span class=p >(</span><span class=n >buf</span><span class=p >,</span><span class=mi >1</span><span class=p >,</span><span class=n >p2</span><span class=o >+</span><span class=mi >1</span><span class=p >,</span><span class=n >stdout</span><span class=p >),</span><span class=n >p2</span><span class=o >=-</span><span class=mi >1</span><span class=p >;}</span>
<span class=kr >inline</span> <span class=kt >void</span> <span class=nf >write</span><span class=p >(</span><span class=kt >int</span> <span class=n >x</span><span class=p >)</span>
<span class=p >{</span>
    <span class=k >if</span><span class=p >(</span><span class=n >p2</span> <span class=o >&gt;</span> <span class=n >FLUSHSIZE</span><span class=p >)</span> <span class=n >flush</span><span class=p >();</span>
    <span class=k >if</span><span class=p >(</span><span class=n >x</span><span class=o >&lt;</span><span class=mi >0</span><span class=p >)</span> <span class=n >buf</span><span class=p >[</span><span class=o >++</span> <span class=n >p2</span><span class=p >]</span><span class=o >=</span><span class=mi >45</span><span class=p >,</span><span class=n >x</span> <span class=o >=</span> <span class=o >-</span><span class=n >x</span><span class=p >;</span>
    <span class=k >do</span><span class=p >{</span><span class=n >print_buf</span><span class=p >[</span><span class=o >++</span> <span class=n >p</span><span class=p >]</span> <span class=o >=</span> <span class=n >x</span> <span class=o >%</span> <span class=mi >10</span> <span class=o >+</span> <span class=mi >48</span><span class=p >;}</span><span class=k >while</span><span class=p >(</span><span class=n >x</span><span class=o >/=</span><span class=mi >10</span><span class=p >);</span>
    <span class=k >do</span><span class=p >{</span><span class=n >buf</span><span class=p >[</span><span class=o >++</span><span class=n >p2</span><span class=p >]</span> <span class=o >=</span> <span class=n >print_buf</span><span class=p >[</span><span class=n >p</span><span class=p >];}</span><span class=k >while</span><span class=p >(</span><span class=o >--</span><span class=n >p</span><span class=p >);</span>
    <span class=n >buf</span><span class=p >[</span><span class=o >++</span><span class=n >p2</span><span class=p >]</span><span class=o >=</span><span class=sc >&#39;\n&#39;</span><span class=p >;</span>
<span class=p >}</span>

<span class=k >const</span> <span class=kt >int</span> <span class=n >N</span> <span class=o >=</span> <span class=mi >100005</span><span class=p >;</span>
<span class=kt >int</span> <span class=n >rt</span><span class=p >,</span> <span class=n >tot</span><span class=p >,</span> <span class=n >fa</span><span class=p >[</span><span class=n >N</span><span class=p >],</span> <span class=n >ch</span><span class=p >[</span><span class=n >N</span><span class=p >][</span><span class=mi >2</span><span class=p >],</span> <span class=n >val</span><span class=p >[</span><span class=n >N</span><span class=p >],</span> <span class=n >cnt</span><span class=p >[</span><span class=n >N</span><span class=p >],</span> <span class=n >sz</span><span class=p >[</span><span class=n >N</span><span class=p >];</span>
<span class=k >struct</span> <span class=n >SPLAY</span>
<span class=p >{</span>
    <span class=kr >inline</span> <span class=kt >void</span> <span class=n >maintain</span><span class=p >(</span><span class=kt >int</span> <span class=n >x</span><span class=p >){</span><span class=n >sz</span><span class=p >[</span><span class=n >x</span><span class=p >]</span> <span class=o >=</span> <span class=n >sz</span><span class=p >[</span><span class=n >ch</span><span class=p >[</span><span class=n >x</span><span class=p >][</span><span class=mi >0</span><span class=p >]]</span> <span class=o >+</span> <span class=n >sz</span><span class=p >[</span><span class=n >ch</span><span class=p >[</span><span class=n >x</span><span class=p >][</span><span class=mi >1</span><span class=p >]]</span> <span class=o >+</span> <span class=n >cnt</span><span class=p >[</span><span class=n >x</span><span class=p >];}</span>
    <span class=kr >inline</span> <span class=kt >bool</span> <span class=n >get</span><span class=p >(</span><span class=kt >int</span> <span class=n >x</span><span class=p >){</span><span class=k >return</span> <span class=n >x</span> <span class=o >==</span> <span class=n >ch</span><span class=p >[</span><span class=n >fa</span><span class=p >[</span><span class=n >x</span><span class=p >]][</span><span class=mi >1</span><span class=p >];}</span>
    <span class=kr >inline</span> <span class=kt >void</span> <span class=n >clear</span><span class=p >(</span><span class=kt >int</span> <span class=n >x</span><span class=p >){</span><span class=n >ch</span><span class=p >[</span><span class=n >x</span><span class=p >][</span><span class=mi >0</span><span class=p >]</span> <span class=o >=</span> <span class=n >ch</span><span class=p >[</span><span class=n >x</span><span class=p >][</span><span class=mi >1</span><span class=p >]</span> <span class=o >=</span> <span class=n >fa</span><span class=p >[</span><span class=n >x</span><span class=p >]</span> <span class=o >=</span> <span class=n >val</span><span class=p >[</span><span class=n >x</span><span class=p >]</span> <span class=o >=</span> <span class=n >sz</span><span class=p >[</span><span class=n >x</span><span class=p >]</span> <span class=o >=</span> <span class=n >cnt</span><span class=p >[</span><span class=n >x</span><span class=p >]</span> <span class=o >=</span> <span class=mi >0</span><span class=p >;}</span>
    <span class=kr >inline</span> <span class=kt >void</span> <span class=n >rotate</span><span class=p >(</span><span class=kt >int</span> <span class=n >x</span><span class=p >)</span>
    <span class=p >{</span>
        <span class=kt >int</span> <span class=n >y</span> <span class=o >=</span> <span class=n >fa</span><span class=p >[</span><span class=n >x</span><span class=p >],</span> <span class=n >z</span> <span class=o >=</span> <span class=n >fa</span><span class=p >[</span><span class=n >y</span><span class=p >],</span> <span class=n >chk</span> <span class=o >=</span> <span class=n >get</span><span class=p >(</span><span class=n >x</span><span class=p >);</span>

        <span class=n >ch</span><span class=p >[</span><span class=n >y</span><span class=p >][</span><span class=n >chk</span><span class=p >]</span> <span class=o >=</span> <span class=n >ch</span><span class=p >[</span><span class=n >x</span><span class=p >][</span><span class=n >chk</span> <span class=o >^</span> <span class=mi >1</span><span class=p >];</span>
        <span class=n >fa</span><span class=p >[</span><span class=n >ch</span><span class=p >[</span><span class=n >x</span><span class=p >][</span><span class=n >chk</span> <span class=o >^</span> <span class=mi >1</span><span class=p >]]</span> <span class=o >=</span> <span class=n >y</span><span class=p >;</span>

        <span class=n >ch</span><span class=p >[</span><span class=n >x</span><span class=p >][</span><span class=n >chk</span> <span class=o >^</span> <span class=mi >1</span><span class=p >]</span> <span class=o >=</span> <span class=n >y</span><span class=p >;</span>
        <span class=n >fa</span><span class=p >[</span><span class=n >y</span><span class=p >]</span> <span class=o >=</span> <span class=n >x</span><span class=p >,</span><span class=n >fa</span><span class=p >[</span><span class=n >x</span><span class=p >]</span> <span class=o >=</span> <span class=n >z</span><span class=p >;</span>

        <span class=k >if</span><span class=p >(</span><span class=n >z</span><span class=p >)</span> <span class=n >ch</span><span class=p >[</span><span class=n >z</span><span class=p >][</span><span class=n >y</span> <span class=o >==</span> <span class=n >ch</span><span class=p >[</span><span class=n >z</span><span class=p >][</span><span class=mi >1</span><span class=p >]]</span> <span class=o >=</span> <span class=n >x</span><span class=p >;</span>
        <span class=n >maintain</span><span class=p >(</span><span class=n >x</span><span class=p >),</span><span class=n >maintain</span><span class=p >(</span><span class=n >y</span><span class=p >);</span>
    <span class=p >}</span>
    <span class=kt >void</span> <span class=n >splay</span><span class=p >(</span><span class=kt >int</span> <span class=n >x</span><span class=p >)</span>
    <span class=p >{</span>
        <span class=k >for</span><span class=p >(</span><span class=kt >int</span> <span class=n >f</span> <span class=o >=</span> <span class=n >fa</span><span class=p >[</span><span class=n >x</span><span class=p >];</span> <span class=n >f</span> <span class=o >=</span> <span class=n >fa</span><span class=p >[</span><span class=n >x</span><span class=p >]</span> <span class=p >,</span><span class=n >f</span> <span class=p >;</span> <span class=n >rotate</span><span class=p >(</span><span class=n >x</span><span class=p >))</span>
            <span class=k >if</span><span class=p >(</span><span class=n >fa</span><span class=p >[</span><span class=n >f</span><span class=p >])</span> <span class=n >rotate</span><span class=p >(</span><span class=n >get</span><span class=p >(</span><span class=n >x</span><span class=p >)</span> <span class=o >==</span> <span class=n >get</span><span class=p >(</span><span class=n >f</span><span class=p >)</span> <span class=o >?</span> <span class=nl >f</span> <span class=p >:</span> <span class=n >x</span><span class=p >);</span>
        <span class=n >rt</span> <span class=o >=</span> <span class=n >x</span><span class=p >;</span>
    <span class=p >}</span>
    <span class=kt >void</span> <span class=n >insert</span><span class=p >(</span><span class=kt >int</span> <span class=n >k</span><span class=p >)</span>
    <span class=p >{</span>
        <span class=k >if</span><span class=p >(</span><span class=o >!</span><span class=n >rt</span><span class=p >)</span> <span class=c1 >//splay is empty</span>
        <span class=p >{</span>
            <span class=n >val</span><span class=p >[</span><span class=o >++</span> <span class=n >tot</span><span class=p >]</span> <span class=o >=</span> <span class=n >k</span><span class=p >,</span><span class=n >cnt</span><span class=p >[</span><span class=n >tot</span><span class=p >]</span> <span class=o >++</span><span class=p >;</span><span class=c1 >//set point</span>
            <span class=n >rt</span> <span class=o >=</span> <span class=n >tot</span><span class=p >,</span><span class=n >maintain</span><span class=p >(</span><span class=n >rt</span><span class=p >);</span><span class=c1 >//set root</span>
            <span class=k >return</span><span class=p >;</span>
        <span class=p >}</span>
        <span class=kt >int</span> <span class=n >cur</span> <span class=o >=</span> <span class=n >rt</span><span class=p >,</span> <span class=n >f</span> <span class=o >=</span> <span class=mi >0</span><span class=p >;</span><span class=c1 >//insert from rt</span>
        <span class=k >while</span><span class=p >(</span><span class=mi >1</span><span class=p >)</span>
        <span class=p >{</span>
            <span class=k >if</span> <span class=p >(</span><span class=n >val</span><span class=p >[</span><span class=n >cur</span><span class=p >]</span> <span class=o >==</span> <span class=n >k</span><span class=p >)</span> <span class=c1 >//find out a point whose value is k</span>
            <span class=p >{</span>
                <span class=n >cnt</span><span class=p >[</span><span class=n >cur</span><span class=p >]</span> <span class=o >++</span><span class=p >;</span><span class=c1 >//size ++</span>
                <span class=n >maintain</span><span class=p >(</span><span class=n >cur</span><span class=p >),</span><span class=n >maintain</span><span class=p >(</span><span class=n >f</span><span class=p >);</span><span class=c1 >//update</span>
                <span class=n >splay</span><span class=p >(</span><span class=n >cur</span><span class=p >);</span><span class=c1 >//rotate to root</span>
                <span class=k >break</span><span class=p >;</span>
            <span class=p >}</span>
            <span class=n >f</span> <span class=o >=</span> <span class=n >cur</span><span class=p >,</span><span class=n >cur</span> <span class=o >=</span> <span class=n >ch</span><span class=p >[</span><span class=n >cur</span><span class=p >][</span><span class=n >val</span><span class=p >[</span><span class=n >cur</span><span class=p >]</span> <span class=o >&lt;</span> <span class=n >k</span><span class=p >];</span><span class=c1 >//find left / right subtree</span>
            <span class=k >if</span><span class=p >(</span><span class=o >!</span><span class=n >cur</span><span class=p >)</span><span class=c1 >// find a empty position to insert</span>
            <span class=p >{</span>
                <span class=n >val</span><span class=p >[</span><span class=o >++</span> <span class=n >tot</span><span class=p >]</span> <span class=o >=</span> <span class=n >k</span><span class=p >,</span><span class=n >cnt</span><span class=p >[</span><span class=n >tot</span><span class=p >]</span><span class=o >++</span><span class=p >;</span>
                <span class=n >fa</span><span class=p >[</span><span class=n >tot</span><span class=p >]</span> <span class=o >=</span> <span class=n >f</span><span class=p >,</span><span class=n >ch</span><span class=p >[</span><span class=n >f</span><span class=p >][</span><span class=n >val</span><span class=p >[</span><span class=n >f</span><span class=p >]</span> <span class=o >&lt;</span> <span class=n >k</span><span class=p >]</span> <span class=o >=</span> <span class=n >tot</span><span class=p >;</span>
                <span class=n >maintain</span><span class=p >(</span><span class=n >tot</span><span class=p >),</span><span class=n >maintain</span><span class=p >(</span><span class=n >f</span><span class=p >);</span><span class=c1 >//update</span>
                <span class=n >splay</span><span class=p >(</span><span class=n >tot</span><span class=p >);</span>
                <span class=k >break</span><span class=p >;</span>
            <span class=p >}</span>
        <span class=p >}</span>
    <span class=p >}</span>
    <span class=kt >int</span> <span class=n >rk</span><span class=p >(</span><span class=kt >int</span> <span class=n >k</span><span class=p >)</span> <span class=c1 >//find k&#39;s rank</span>
    <span class=p >{</span>
        <span class=kt >int</span> <span class=n >res</span> <span class=o >=</span> <span class=mi >0</span><span class=p >,</span> <span class=n >cur</span> <span class=o >=</span> <span class=n >rt</span><span class=p >;</span>
        <span class=k >while</span><span class=p >(</span><span class=mi >1</span><span class=p >)</span>
        <span class=p >{</span>
            <span class=k >if</span><span class=p >(</span><span class=n >k</span> <span class=o >&lt;</span> <span class=n >val</span><span class=p >[</span><span class=n >cur</span><span class=p >])</span> <span class=n >cur</span> <span class=o >=</span> <span class=n >ch</span><span class=p >[</span><span class=n >cur</span><span class=p >][</span><span class=mi >0</span><span class=p >];</span><span class=c1 >//find left subtree</span>
            <span class=k >else</span> <span class=c1 >//find right subtree</span>
            <span class=p >{</span>
                <span class=n >res</span> <span class=o >+=</span> <span class=n >sz</span><span class=p >[</span><span class=n >ch</span><span class=p >[</span><span class=n >cur</span><span class=p >][</span><span class=mi >0</span><span class=p >]];</span><span class=c1 >//add left subtree&#39;s size</span>
                <span class=k >if</span><span class=p >(</span><span class=n >k</span> <span class=o >==</span> <span class=n >val</span><span class=p >[</span><span class=n >cur</span><span class=p >])</span><span class=c1 >//find out element</span>
                <span class=p >{</span>
                    <span class=n >splay</span><span class=p >(</span><span class=n >cur</span><span class=p >);</span><span class=c1 >//rotate to root</span>
                    <span class=k >return</span> <span class=n >res</span> <span class=o >+</span> <span class=mi >1</span><span class=p >;</span><span class=c1 >//return rank</span>
                <span class=p >}</span>
                <span class=n >res</span> <span class=o >+=</span> <span class=n >cnt</span><span class=p >[</span><span class=n >cur</span><span class=p >];</span><span class=c1 >//add current point value</span>
                <span class=n >cur</span> <span class=o >=</span> <span class=n >ch</span><span class=p >[</span><span class=n >cur</span><span class=p >][</span><span class=mi >1</span><span class=p >];</span><span class=c1 >//find right subtree</span>
            <span class=p >}</span>
        <span class=p >}</span>
    <span class=p >}</span>
    <span class=kt >int</span> <span class=n >kth</span><span class=p >(</span><span class=kt >int</span> <span class=n >k</span><span class=p >)</span>
    <span class=p >{</span>
        <span class=kt >int</span> <span class=n >cur</span> <span class=o >=</span> <span class=n >rt</span><span class=p >;</span>
        <span class=k >while</span><span class=p >(</span><span class=mi >1</span><span class=p >)</span>
        <span class=p >{</span>
            <span class=k >if</span><span class=p >(</span><span class=n >ch</span><span class=p >[</span><span class=n >cur</span><span class=p >][</span><span class=mi >0</span><span class=p >]</span> <span class=o >&amp;&amp;</span> <span class=n >k</span> <span class=o >&lt;=</span> <span class=n >sz</span><span class=p >[</span><span class=n >ch</span><span class=p >[</span><span class=n >cur</span><span class=p >][</span><span class=mi >0</span><span class=p >]])</span>
                <span class=n >cur</span> <span class=o >=</span> <span class=n >ch</span><span class=p >[</span><span class=n >cur</span><span class=p >][</span><span class=mi >0</span><span class=p >];</span> <span class=c1 >//find left subtree</span>
            <span class=k >else</span>
            <span class=p >{</span>
                <span class=n >k</span> <span class=o >-=</span> <span class=n >cnt</span><span class=p >[</span><span class=n >cur</span><span class=p >]</span> <span class=o >+</span> <span class=n >sz</span><span class=p >[</span><span class=n >ch</span><span class=p >[</span><span class=n >cur</span><span class=p >][</span><span class=mi >0</span><span class=p >]];</span> <span class=c1 >//find right subtree</span>
                <span class=k >if</span><span class=p >(</span><span class=n >k</span> <span class=o >&lt;=</span> <span class=mi >0</span><span class=p >)</span> <span class=k >return</span> <span class=n >val</span><span class=p >[</span><span class=n >cur</span><span class=p >];</span><span class=c1 >//return current point value</span>
                <span class=n >cur</span> <span class=o >=</span> <span class=n >ch</span><span class=p >[</span><span class=n >cur</span><span class=p >][</span><span class=mi >1</span><span class=p >];</span><span class=c1 >//find right subtree</span>
            <span class=p >}</span>
        <span class=p >}</span>
    <span class=p >}</span>
    <span class=kt >int</span> <span class=n >pre</span><span class=p >()</span><span class=c1 >//find root&#39;s predecessor</span>
    <span class=p >{</span>
        <span class=kt >int</span> <span class=n >cur</span> <span class=o >=</span> <span class=n >ch</span><span class=p >[</span><span class=n >rt</span><span class=p >][</span><span class=mi >0</span><span class=p >];</span><span class=c1 >//find left subtree</span>
        <span class=k >while</span><span class=p >(</span><span class=n >ch</span><span class=p >[</span><span class=n >cur</span><span class=p >][</span><span class=mi >1</span><span class=p >])</span> <span class=n >cur</span> <span class=o >=</span> <span class=n >ch</span><span class=p >[</span><span class=n >cur</span><span class=p >][</span><span class=mi >1</span><span class=p >];</span><span class=c1 >//find right subtree</span>
        <span class=k >return</span> <span class=n >cur</span><span class=p >;</span>
    <span class=p >}</span>
    <span class=kt >int</span> <span class=n >nxt</span><span class=p >()</span>
    <span class=p >{</span>
        <span class=kt >int</span> <span class=n >cur</span> <span class=o >=</span> <span class=n >ch</span><span class=p >[</span><span class=n >rt</span><span class=p >][</span><span class=mi >1</span><span class=p >];</span><span class=c1 >//find right subtree</span>
        <span class=k >while</span> <span class=p >(</span><span class=n >ch</span><span class=p >[</span><span class=n >cur</span><span class=p >][</span><span class=mi >0</span><span class=p >])</span> <span class=n >cur</span> <span class=o >=</span> <span class=n >ch</span><span class=p >[</span><span class=n >cur</span><span class=p >][</span><span class=mi >0</span><span class=p >];</span><span class=c1 >//find left subtree</span>
        <span class=k >return</span> <span class=n >cur</span><span class=p >;</span>
    <span class=p >}</span>
    <span class=kt >void</span> <span class=n >del</span><span class=p >(</span><span class=kt >int</span> <span class=n >k</span><span class=p >)</span>
    <span class=p >{</span>
        <span class=n >rk</span><span class=p >(</span><span class=n >k</span><span class=p >);</span>
        <span class=k >if</span><span class=p >(</span><span class=n >cnt</span><span class=p >[</span><span class=n >rt</span><span class=p >]</span> <span class=o >&gt;</span> <span class=mi >1</span><span class=p >)</span> <span class=c1 >//have many same point</span>
        <span class=p >{</span>
            <span class=n >cnt</span><span class=p >[</span><span class=n >rt</span><span class=p >]</span><span class=o >--</span><span class=p >;</span><span class=c1 >//delete one and update</span>
            <span class=n >maintain</span><span class=p >(</span><span class=n >rt</span><span class=p >);</span>
            <span class=k >return</span><span class=p >;</span>
        <span class=p >}</span>
        <span class=k >if</span><span class=p >(</span><span class=o >!</span><span class=n >ch</span><span class=p >[</span><span class=n >rt</span><span class=p >][</span><span class=mi >0</span><span class=p >]</span> <span class=o >&amp;&amp;</span> <span class=o >!</span><span class=n >ch</span><span class=p >[</span><span class=n >rt</span><span class=p >][</span><span class=mi >1</span><span class=p >])</span> <span class=c1 >//have no left / right son</span>
        <span class=p >{</span>
            <span class=n >clear</span><span class=p >(</span><span class=n >rt</span><span class=p >);</span><span class=c1 >//delete</span>
            <span class=n >rt</span> <span class=o >=</span> <span class=mi >0</span><span class=p >;</span>
            <span class=k >return</span><span class=p >;</span>
        <span class=p >}</span>
        <span class=k >if</span><span class=p >(</span><span class=o >!</span><span class=n >ch</span><span class=p >[</span><span class=n >rt</span><span class=p >][</span><span class=mi >0</span><span class=p >])</span> <span class=c1 >//only have right son</span>
        <span class=p >{</span>
            <span class=kt >int</span> <span class=n >cur</span> <span class=o >=</span> <span class=n >rt</span><span class=p >;</span>
            <span class=n >rt</span> <span class=o >=</span> <span class=n >ch</span><span class=p >[</span><span class=n >rt</span><span class=p >][</span><span class=mi >1</span><span class=p >];</span>
            <span class=n >fa</span><span class=p >[</span><span class=n >rt</span><span class=p >]</span> <span class=o >=</span> <span class=mi >0</span><span class=p >;</span>
            <span class=n >clear</span><span class=p >(</span><span class=n >cur</span><span class=p >);</span>
            <span class=k >return</span><span class=p >;</span>
        <span class=p >}</span>
        <span class=k >if</span><span class=p >(</span><span class=o >!</span><span class=n >ch</span><span class=p >[</span><span class=n >rt</span><span class=p >][</span><span class=mi >1</span><span class=p >])</span> <span class=c1 >//only have left son</span>
        <span class=p >{</span>
            <span class=kt >int</span> <span class=n >cur</span> <span class=o >=</span> <span class=n >rt</span><span class=p >;</span>
            <span class=n >rt</span> <span class=o >=</span> <span class=n >ch</span><span class=p >[</span><span class=n >rt</span><span class=p >][</span><span class=mi >0</span><span class=p >];</span>
            <span class=n >fa</span><span class=p >[</span><span class=n >rt</span><span class=p >]</span> <span class=o >=</span> <span class=mi >0</span><span class=p >;</span>
            <span class=n >clear</span><span class=p >(</span><span class=n >cur</span><span class=p >);</span>
            <span class=k >return</span><span class=p >;</span>
        <span class=p >}</span>
        <span class=kt >int</span> <span class=n >x</span> <span class=o >=</span> <span class=n >pre</span><span class=p >(),</span> <span class=n >cur</span> <span class=o >=</span> <span class=n >rt</span><span class=p >;</span>
        <span class=n >splay</span><span class=p >(</span><span class=n >x</span><span class=p >),</span><span class=n >fa</span><span class=p >[</span><span class=n >ch</span><span class=p >[</span><span class=n >cur</span><span class=p >][</span><span class=mi >1</span><span class=p >]]</span> <span class=o >=</span> <span class=n >x</span><span class=p >;</span><span class=c1 >//right son&#39;s father is x&#39;s predecessor</span>
        <span class=n >ch</span><span class=p >[</span><span class=n >x</span><span class=p >][</span><span class=mi >1</span><span class=p >]</span> <span class=o >=</span> <span class=n >ch</span><span class=p >[</span><span class=n >cur</span><span class=p >][</span><span class=mi >1</span><span class=p >];</span><span class=c1 >//x&#39;s predecessor &#39;s right son is x&#39;s right son</span>
        <span class=n >clear</span><span class=p >(</span><span class=n >cur</span><span class=p >),</span><span class=n >maintain</span><span class=p >(</span><span class=n >rt</span><span class=p >);</span>
    <span class=p >}</span>
<span class=p >}</span><span class=n >tree</span><span class=p >;</span>

<span class=kt >int</span> <span class=nf >main</span><span class=p >()</span>
<span class=p >{</span>
    <span class=cp >#ifndef ONLINE_JUDGE</span>
        <span class=n >file</span><span class=p >(</span><span class=s >&quot;splay&quot;</span><span class=p >);</span>
    <span class=cp >#endif</span>

    <span class=kt >int</span> <span class=n >n</span> <span class=o >=</span> <span class=n >read</span><span class=p >(),</span> <span class=n >opt</span><span class=p >,</span> <span class=n >x</span><span class=p >;</span>
    <span class=k >for</span><span class=p >(</span><span class=kt >int</span> <span class=n >i</span> <span class=o >=</span> <span class=mi >0</span><span class=p >;</span><span class=n >i</span> <span class=o >&lt;</span> <span class=n >n</span><span class=p >;</span><span class=n >i</span> <span class=o >++</span><span class=p >)</span>
    <span class=p >{</span>
        <span class=n >opt</span> <span class=o >=</span> <span class=n >read</span><span class=p >(),</span><span class=n >x</span> <span class=o >=</span> <span class=n >read</span><span class=p >();</span>
        <span class=k >if</span><span class=p >(</span><span class=n >opt</span> <span class=o >==</span> <span class=mi >1</span><span class=p >)</span> <span class=n >tree</span><span class=p >.</span><span class=n >insert</span><span class=p >(</span><span class=n >x</span><span class=p >);</span>
        <span class=k >else</span> <span class=k >if</span><span class=p >(</span><span class=n >opt</span> <span class=o >==</span> <span class=mi >2</span><span class=p >)</span> <span class=n >tree</span><span class=p >.</span><span class=n >del</span><span class=p >(</span><span class=n >x</span><span class=p >);</span>
        <span class=k >else</span> <span class=k >if</span><span class=p >(</span><span class=n >opt</span> <span class=o >==</span> <span class=mi >3</span><span class=p >)</span> <span class=n >write</span><span class=p >(</span><span class=n >tree</span><span class=p >.</span><span class=n >rk</span><span class=p >(</span><span class=n >x</span><span class=p >));</span>
        <span class=k >else</span> <span class=k >if</span><span class=p >(</span><span class=n >opt</span> <span class=o >==</span> <span class=mi >4</span><span class=p >)</span> <span class=n >write</span><span class=p >(</span><span class=n >tree</span><span class=p >.</span><span class=n >kth</span><span class=p >(</span><span class=n >x</span><span class=p >));</span>
        <span class=k >else</span> <span class=k >if</span><span class=p >(</span><span class=n >opt</span> <span class=o >==</span> <span class=mi >5</span><span class=p >)</span> <span class=n >tree</span><span class=p >.</span><span class=n >insert</span><span class=p >(</span><span class=n >x</span><span class=p >),</span><span class=n >write</span><span class=p >(</span><span class=n >val</span><span class=p >[</span><span class=n >tree</span><span class=p >.</span><span class=n >pre</span><span class=p >()]),</span> <span class=n >tree</span><span class=p >.</span><span class=n >del</span><span class=p >(</span><span class=n >x</span><span class=p >);</span>
        <span class=k >else</span> <span class=n >tree</span><span class=p >.</span><span class=n >insert</span><span class=p >(</span><span class=n >x</span><span class=p >),</span> <span class=n >write</span><span class=p >(</span><span class=n >val</span><span class=p >[</span><span class=n >tree</span><span class=p >.</span><span class=n >nxt</span><span class=p >()]),</span><span class=n >tree</span><span class=p >.</span><span class=n >del</span><span class=p >(</span><span class=n >x</span><span class=p >);</span>
    <span class=p >}</span>
    <span class=n >flush</span><span class=p >();</span>

    <span class=cp >#ifndef ONLINE_JUDGE</span>
        <span class=n >file_close</span><span class=p >;</span>
    <span class=cp >#endif</span>
    <span class=k >return</span> <span class=mi >0</span><span class=p >;</span>
<span class=p >}</span>
</pre></div> </table> <hr/> <div id=comments ></div> <script> window.addEventListener('load', () => { quicklink(); }); const gitment = new Gitment({id: '3ef3c0d672a5f9ee5758fb6e9d3742a8', owner: 'eqvpkbz', repo: 'eqvpkbz.github.io', oauth: { client_id: 'f3fcfa20487ff3c17b18', client_secret: '6417358b1238dde3f33dd28c2bb10693b7604ce2' }, perPage: 10, }); gitment.render('comments'); </script> </div> </div> <div class="mdl-cell sidebar"> <div class=article > <div class="mdl-card mdl-shadow--2dp sidebar-card"> <div class="mdl-card__actions sidebar-title">页面信息</div> <div class=mdl-card__supporting-text > 标签: <a href="/search.html?q=Data Structure"><span class=label >Data Structure</span></a><br/> 创建时间: 2019.11.03<br/> 上次修改: 2019.11.03<br/> 字数统计: 6929 字 / 约 27 分钟 </div> </div> <br/> <div class="mdl-card mdl-shadow--2dp sidebar-card"> <div class="mdl-card__actions sidebar-title">目录</div> <div class=mdl-card__supporting-text > <div class=toc > <ul> <li><a href="#splay">初探splay</a> </ul> <ul><li><a href="#comments">评论区</a></ul></div> </div> </div> <br/> <div class="mdl-card mdl-shadow--2dp sidebar-card"> <div class="mdl-card__actions sidebar-title">数学公式渲染</div> <div class=mdl-card__supporting-text > <form name=mathopt > <label class="mdl-radio mdl-js-radio" for=option-1 > <input type=radio  id=option-1  class=mdl-radio__button  name=sel  value=mathjax > <span class=mdl-radio__label >MathJax</span> </label><br/> <label class="mdl-radio mdl-js-radio" for=option-2 > <input type=radio  id=option-2  class=mdl-radio__button  name=sel  value=katex > <span class=mdl-radio__label >KaTeX</span> </label> <div id=tip-1 > <label class="mdl-radio mdl-js-radio" for=option-3 > <input type=radio  id=option-3  class=mdl-radio__button  name=sel  value="katex&mathjax"> <span class=mdl-radio__label >Mixed</span> </label> </div> </form> <div id=tip-2 > <label class="mdl-checkbox mdl-js-checkbox" for=mathopt-align > <input type=checkbox  id=mathopt-align  class=mdl-checkbox__input > <span class=mdl-checkbox__label >居中显示</span> </label> </div> </div> </div> <div class=mdl-tooltip  data-mdl-for=tip-1 >先使用 KaTeX 渲染，再使用 MathJax 渲染</div> <div class=mdl-tooltip  data-mdl-for=tip-2 >该选项目前仅支持 KaTeX 渲染的公式<br/>点击公式可以切换单个公式的对齐方式</div> <br/> <div class="nano mdl-card mdl-shadow--2dp sidebar-card"> <div class=mdl-card__actions > <div class=nano-shell ><span class=shell-start >$</span> nano <a href="https://github.com/eqvpkbz/eqvpkbz.github.io/blob/master/blog/2019-11-3/splay.md" id=nano-link >splay.md</a></div> </div> </div> <div class=mdl-tooltip  data-mdl-for=nano-link >查看原始 Markdown 文档</div> </div> </div> </div> <footer class=mdl-mega-footer > <div class=mdl-mega-footer__middle-section > <div class=mdl-mega-footer__drop-down-section > <input class=mdl-mega-footer__heading-checkbox  type=checkbox  checked> <h2 class=mdl-mega-footer__heading >EQVPKBZ.GITHUB.IO</h2><del>一个不太正经的博客</del> </div> <div class=mdl-mega-footer__drop-down-section > <input class=mdl-mega-footer__heading-checkbox  type=checkbox  checked> <h2 class=mdl-mega-footer__heading >POWERED BY</h2> <ul class=mdl-mega-footer__link-list > <li><a href="http://pythonhosted.org/Markdown/">Python Markdown</a> <li><a href="http://getmdl.io/">Material Design Lite</a> <li><a href="http://www.tipue.com/search/">Tipuesearch</a> <li><a href="http://www.mathjax.org/">MathJax</a> & <a href="http://khan.github.io/KaTeX/">KaTeX</a> <li><a href="https://github.com/imsun/gitment">Gitment</a> </ul> </div> <div class=mdl-mega-footer__drop-down-section > <input class=mdl-mega-footer__heading-checkbox  type=checkbox  checked> <h2 class=mdl-mega-footer__heading >有用的网站</h2> <ul class=mdl-mega-footer__link-list > <li><a href="https://www.luogu.org/">Luogu</a> <li><a href="https://shields.io/">shields.io</a> <li><a href="https://csacademy.com/app/graph_editor/">graph_editor</a> <li><a href="https://csacademy.com/app/diffing_tool/">diffing_tool</a> <li><a href="https://csacademy.com/app/graph_editor/">graph_editor</a> <li><a href="https://csacademy.com/app/graph_editor/">graph_editor</a> </ul> </div> </div> <div class=mdl-mega-footer__bottom-section >Theme based on <a href="https://getmdl.io/">MDL</a> | <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" class=cc  src="/assets/cc-by-nc-sa-4.png" /></a> CC BY-NC-SA 4.0 </div> </footer> </main> </div>